<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>人工智能导论HW1实验报告 | detect</title><meta name="author" content="Richard,detect0530@gmail.com"><meta name="copyright" content="Richard"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="报告题目：Bait游戏&amp;搜索算法   detect0530@gmail.com  引言： 在个人过去的实践中，搜索算法是低效暴力的代名词，但是通过本课程的学习，从深度优先宽度优先到代价优先，再到A*算法，我才发现搜索算法的强大之处。优秀的启发式函数可以大大提高搜索效率，搜索算法的强大之处在于其可以解决各式各样的问题，比如本次实验中的Bait游戏，可以通过搜索算法来解决。并在一次次优化算法">
<meta property="og:type" content="article">
<meta property="og:title" content="人工智能导论HW1实验报告">
<meta property="og:url" content="https://detect42.github.io/post/776c3856.html">
<meta property="og:site_name" content="detect">
<meta property="og:description" content="报告题目：Bait游戏&amp;搜索算法   detect0530@gmail.com  引言： 在个人过去的实践中，搜索算法是低效暴力的代名词，但是通过本课程的学习，从深度优先宽度优先到代价优先，再到A*算法，我才发现搜索算法的强大之处。优秀的启发式函数可以大大提高搜索效率，搜索算法的强大之处在于其可以解决各式各样的问题，比如本次实验中的Bait游戏，可以通过搜索算法来解决。并在一次次优化算法">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://detect42.github.io/img/ff.jpg">
<meta property="article:published_time" content="2023-09-22T07:21:46.000Z">
<meta property="article:modified_time" content="2024-03-07T13:10:03.884Z">
<meta property="article:author" content="Richard">
<meta property="article:tag" content="实验报告">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://detect42.github.io/img/ff.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://detect42.github.io/post/776c3856.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":1000},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '人工智能导论HW1实验报告',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-07 21:10:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/1.css"><meta name="generator" content="Hexo 6.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/ff.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">77</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">26</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/topimg.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="detect"><span class="site-name">detect</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">人工智能导论HW1实验报告</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-09-22T07:21:46.000Z" title="Created 2023-09-22 15:21:46">2023-09-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-03-07T13:10:03.884Z" title="Updated 2024-03-07 21:10:03">2024-03-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NJU-course/">NJU course</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NJU-course/IntroAI/">IntroAI</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">8.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>41min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="人工智能导论HW1实验报告"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="center-报告题目：bait游戏-搜索算法-center"><center> 报告题目：Bait游戏&amp;搜索算法 </center></h1>
<h3 id="center-detect0530-gmail-com-center"><center> <a href="mailto:detect0530@gmail.com">detect0530@gmail.com</a> </center></h3>
<h2 id="引言：">引言：</h2>
<p>在个人过去的实践中，搜索算法是低效暴力的代名词，但是通过本课程的学习，从深度优先宽度优先到代价优先，再到A*算法，我才发现搜索算法的强大之处。优秀的启发式函数可以大大提高搜索效率，搜索算法的强大之处在于其可以解决各式各样的问题，比如本次实验中的Bait游戏，可以通过搜索算法来解决。并在一次次优化算法的过程中，我也对搜索算法有了更深的理解。</p>
<h1 id="2-实验内容">2 实验内容</h1>
<h2 id="2-1-task1-深度优先搜索">2.1 Task1: 深度优先搜索</h2>
<h3 id="2-1-1-记录走过的状态">2.1.1 记录走过的状态</h3>
<p>要求使用深度优先搜索完成Bait游戏，我们首先要确保一定可以遍历完所有的情况（即completion），因为游戏规定精灵可以上下左右移动，那么每张地图都构成一个图，那么首要问题就是避免死循环，即避免走“回头路”，我们使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> ArrayList&lt;StateObservation&gt; Visited= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;StateObservation&gt;();</span><br></pre></td></tr></table></figure>
<p>定义一个状态数组表示已经走过的状态，仔细阅读源码框架后，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>O</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">StateObservation</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">b</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span>类表示了当前局面的所有信息，因为实际上我们不能只是简单的记录走过的坐标集合，因为一旦精灵拿到钥匙或者推开箱子都会使得局面状态改变而使得同样坐标的位置可以再次走到，所以我们需要记录每个局面的状态，即记录每个局面的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>O</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">StateObservation</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">b</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span>。</p>
<p>同时注意到，比较两个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>O</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">StateObservation</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">b</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span>是否相同的方法不能简单用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mo>=</mo></mrow><annotation encoding="application/x-tex">==</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span></span></span></span>，在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>O</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">StateObservation</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">b</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span>类中给了我们<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>q</mi><mi>u</mi><mi>a</mi><mi>l</mi><mi>P</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">equalPosition</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mord mathdefault">u</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span>接口。于是我们创建一个方法用来判断当前局面是否已经走过：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">CheckifVisited</span><span class="params">(StateObservation stataObs)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Visited.size(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stataObs.equalPosition(Visited.get(i))) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-1-2-act接口调用">2.1.2 act接口调用</h3>
<p>阅读框架源码知<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">controler</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>每次行动调用的是act函数，也就是说我们搜索结束后，不能直接返回<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">action</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span>数组，而是：</p>
<ul>
<li>
<ol>
<li>第一次act时，搜索得到正确actionlist，返回第一个元素。</li>
</ol>
</li>
<li>
<ol start="2">
<li>第二次act时，返回actionlist的第二个元素。</li>
</ol>
</li>
<li>
<ol start="3">
<li>依此类推…</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//act函数内：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(OK==<span class="literal">true</span>)&#123;</span><br><span class="line">    numstep++;</span><br><span class="line">    <span class="keyword">return</span> DFSActions.get(numstep);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">Visited.clear();</span><br><span class="line">DFSActions.clear();</span><br><span class="line">DFS(stateObs,elapsedTimer);</span><br><span class="line"><span class="keyword">if</span>(DFSActions.size()==<span class="number">0</span>)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;action nil&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Types.ACTIONS.ACTION_NIL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    OK=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> DFSActions.get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-1-3-深度优先搜索的实现">2.1.3 深度优先搜索的实现</h3>
<p>我采用递归的方式实现DFS，每次递归时，先判断当前局面是否已经走过，如果走过则返回，否则将当前局面加入<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">Visited</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span></span></span></span>数组，然后判断当前局面是否为终局，如果是则返回，否则遍历当前局面的所有可行动作，对每个动作进行递归，直到找到终局或者所有动作都走过。</p>
<p>在搜索的时候，我始终使用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>F</mi><mi>S</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">DFSaction</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span></span></span></span>数组记录当前的动作序列。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">boolean</span> <span class="title function_">DFS</span><span class="params">(StateObservation stataObs, ElapsedCpuTimer elapsedTimer)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(CheckifVisited(stataObs))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Visited.add(stataObs);</span><br><span class="line">    <span class="type">StateObservation</span> <span class="variable">stCopy</span> <span class="operator">=</span> stataObs.copy();</span><br><span class="line">    ArrayList&lt;Types.ACTIONS&gt; actions = stataObs.getAvailableActions();</span><br><span class="line">    <span class="comment">//  StateObservation stCopy = stataObs.copy(),re=null;</span></span><br><span class="line">    <span class="keyword">for</span>(Types.ACTIONS action:actions) &#123;</span><br><span class="line">        stCopy.advance(action);</span><br><span class="line">        DFSActions.add(action);</span><br><span class="line">        <span class="keyword">if</span> (stCopy.getGameWinner() == Types.WINNER.PLAYER_WINS) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (CheckifVisited(stCopy) || stCopy.isGameOver()) &#123;</span><br><span class="line">            stCopy = stataObs.copy();</span><br><span class="line">            DFSActions.remove(DFSActions.size() - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (DFS(stCopy, elapsedTimer)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            stCopy = stataObs.copy();</span><br><span class="line">            DFSActions.remove(DFSActions.size() - <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-1-4-task1-完整代码展示">2.1.4 TASK1 完整代码展示</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers.dfs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics2D;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> core.game.ForwardModel;</span><br><span class="line"><span class="keyword">import</span> core.game.Observation;</span><br><span class="line"><span class="keyword">import</span> core.game.StateObservation;</span><br><span class="line"><span class="keyword">import</span> core.player.AbstractPlayer;</span><br><span class="line"><span class="keyword">import</span> ontology.Types;</span><br><span class="line"><span class="keyword">import</span> tools.ElapsedCpuTimer;</span><br><span class="line"><span class="keyword">import</span> tools.Vector2d;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Agent</span> <span class="keyword">extends</span> <span class="title class_">AbstractPlayer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Random generator for the agent.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> Random randomGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Observation grid.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> ArrayList&lt;Observation&gt; grid[][];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * block size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> block_size,numstep=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> OK=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;StateObservation&gt; Visited= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;StateObservation&gt;();</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Vector2d&gt; Key= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;tools.Vector2d&gt;();</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Types.ACTIONS&gt;  DFSActions= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Types.ACTIONS&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Agent</span><span class="params">(StateObservation so, ElapsedCpuTimer elapsedTimer)</span></span><br><span class="line">    &#123;</span><br><span class="line">        randomGenerator = <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        grid = so.getObservationGrid();</span><br><span class="line">        block_size = so.getBlockSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">CheckifVisited</span><span class="params">(StateObservation stataObs)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Visited.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (stataObs.equalPosition(Visited.get(i))) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">DFS</span><span class="params">(StateObservation stataObs, ElapsedCpuTimer elapsedTimer)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(CheckifVisited(stataObs))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Visited.add(stataObs);</span><br><span class="line">        <span class="type">StateObservation</span> <span class="variable">stCopy</span> <span class="operator">=</span> stataObs.copy();</span><br><span class="line">        ArrayList&lt;Types.ACTIONS&gt; actions = stataObs.getAvailableActions();</span><br><span class="line">      <span class="comment">//  StateObservation stCopy = stataObs.copy(),re=null;</span></span><br><span class="line">        <span class="keyword">for</span>(Types.ACTIONS action:actions) &#123;</span><br><span class="line">            stCopy.advance(action);</span><br><span class="line">            DFSActions.add(action);</span><br><span class="line">            <span class="keyword">if</span> (stCopy.getGameWinner() == Types.WINNER.PLAYER_WINS) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (CheckifVisited(stCopy) || stCopy.isGameOver()) &#123;</span><br><span class="line">                stCopy = stataObs.copy();</span><br><span class="line">                DFSActions.remove(DFSActions.size() - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (DFS(stCopy, elapsedTimer)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                stCopy = stataObs.copy();</span><br><span class="line">                DFSActions.remove(DFSActions.size() - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Types.ACTIONS <span class="title function_">act</span><span class="params">(StateObservation stateObs, ElapsedCpuTimer elapsedTimer)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(OK==<span class="literal">true</span>)&#123;</span><br><span class="line">            numstep++;</span><br><span class="line">            <span class="keyword">return</span> DFSActions.get(numstep);</span><br><span class="line">        &#125;</span><br><span class="line">        grid = stateObs.getObservationGrid();</span><br><span class="line"></span><br><span class="line">        Visited.clear();</span><br><span class="line">        DFSActions.clear();</span><br><span class="line">        DFS(stateObs,elapsedTimer);</span><br><span class="line">        <span class="keyword">if</span>(DFSActions.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;action nil&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Types.ACTIONS.ACTION_NIL;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            OK=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span> DFSActions.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-1-5-algorithm-performance">2.1.5 Algorithm Performance</h3>
<p>在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mi>s</mi></mrow><annotation encoding="application/x-tex">10s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord mathdefault">s</span></span></span></span>的限制里可以解决第1,2,3张地图。但是很明显看出来路径有随机性，很多时候绕了路。</p>
<hr>
<hr>
<h2 id="2-2-task2-深度受限的搜索-初步astar">2.2 Task2: 深度受限的搜索+初步Astar</h2>
<p>起初看题以为是加个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mi>L</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">MaxDepthLimitt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span></span></span></span>就完事了，但是注意到题目有要求用启发式函数。我们不妨把这两者结合，即：</p>
<ul>
<li>搜索中仍有深度要求，搜到指定的参数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mi>L</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">MaxDepthLimit</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span></span></span></span>后就返回。</li>
<li>对于深度达到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mi>L</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">MaxDepthLimit</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span></span></span></span>或者终局的局面，我们用启发式函数来评估这个局面的好坏。</li>
</ul>
<p>基于上述两点，我们一次可以找到多个深度为指定值的局面并使用启发式函数选择最好的一个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>L</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">ActionList</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span></span></span></span>执行。</p>
<h3 id="2-2-1-启发式函数的设计">2.2.1 启发式函数的设计</h3>
<p>本题只是设计一个简单的启发式函数，初心是过TASK1即可，行之有效的启发式函数设计待我在后面的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∗</mo></mrow><annotation encoding="application/x-tex">A*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord">∗</span></span></span></span>算法时来介绍。</p>
<ul>
<li>
<p>赢得游戏 score + 1*W_1</p>
</li>
<li>
<p>丢失游戏 score - 1*W_2</p>
</li>
<li>
<p>计算得分 score + GetGameScore()*W_3</p>
</li>
<li>
<p>得到钥匙 score + 1*W_1</p>
</li>
<li>
<p>箱子推到了钥匙位置上 score - W_4</p>
</li>
<li>
<p>Distance：</p>
<ol>
<li>
<p>拿到钥匙前：score - DistanceToKey()*W_5</p>
</li>
<li>
<p>拿到钥匙后：score + DistanceToDoor()*W_6</p>
</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">heuristic</span><span class="params">(StateObservation stateObs)</span>&#123;</span><br><span class="line">    <span class="type">int</span> score=<span class="number">0</span>;</span><br><span class="line">    ArrayList&lt;Observation&gt;[] movingPositions = stateObs.getMovablePositions();</span><br><span class="line">    <span class="keyword">if</span>(stateObs.getGameWinner()==Types.WINNER.PLAYER_WINS)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Winnnnnn&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Visited.size();i++)&#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;Visited x=&quot;</span> + (Visited.get(i).getAvatarPosition().x/<span class="number">50</span>+<span class="number">1</span>) + <span class="string">&quot; y=&quot;</span> + (Visited.get(i).getAvatarPosition().y/<span class="number">50</span>+<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        score+=<span class="number">1000000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(stateObs.getGameWinner()==Types.WINNER.PLAYER_LOSES)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Loseeeee&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Visited.size();i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Visited x=&quot;</span> + (Visited.get(i).getAvatarPosition().x/<span class="number">50</span>+<span class="number">1</span>) + <span class="string">&quot; y=&quot;</span> + (Visited.get(i).getAvatarPosition().y/<span class="number">50</span>+<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        score-=<span class="number">1000000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    score+=(<span class="type">int</span>)stateObs.getGameScore()*<span class="number">100</span>;</span><br><span class="line">  <span class="comment">//  System.out.println(&quot;score= &quot; + score);</span></span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> flag=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Visited.size();i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(keypos.equals(stateObs.getAvatarPosition()))&#123;</span><br><span class="line">            flag=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(keypos.equals(stateObs.getAvatarPosition())) flag=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">// System.out.println(stateObs.getAvatarPosition() + &quot; &quot; + keypos);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(flag&amp;&amp;KKK) score+=<span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(Getkey(stateObs).isEmpty())&#123;</span><br><span class="line">        score-=GetDistance(stateObs.getAvatarPosition(),goalpos);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(GetBox(stateObs).contains(keypos)) score-=<span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line">        score-=GetDistance(stateObs.getAvatarPosition(),keypos);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">// System.out.println(&quot;score= &quot; + score);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> score;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-2-2-搜索的实现">2.2.2 搜索的实现</h3>
<p>和第一题类似，只不过加了个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mi>L</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">MaxDepthLimit</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span></span></span></span>的限制，然后选择最优的启发式<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>o</mi><mi>c</mi><mi>r</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">socre</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span></span></span></span>对应的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>L</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">ActionList</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span></span></span></span>即。</p>
<p>细节上说，设置一个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi mathvariant="normal">_</mi><mi>I</mi><mi>n</mi><mi>i</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Has\_Init</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span></span></span></span>开关，控制现在是否已经初始化，如果现在还没初始化，则每次搜索前先清空<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">Visited</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span></span></span></span>数组和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>F</mi><mi>S</mi><mi>A</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">DFSActions</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">A</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span></span></span></span>数组，然后再进行搜索。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">LFS</span><span class="params">(StateObservation stataObs, ElapsedCpuTimer elapsedTimer,<span class="type">int</span> dep)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(dep==MaxDepth||stataObs.getGameWinner()==Types.WINNER.PLAYER_WINS)&#123;</span><br><span class="line">        <span class="type">int</span> score=heuristic(stataObs);</span><br><span class="line">        <span class="keyword">if</span>(score&gt;MaxScore)&#123;</span><br><span class="line">            MaxScore=score;</span><br><span class="line">            MaxAction= (ArrayList&lt;Types.ACTIONS&gt;) DFSActions.clone();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(Has_Init)&#123;</span><br><span class="line">        <span class="keyword">if</span>(CheckifVisited(stataObs))&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        Visited.clear();</span><br><span class="line">        DFSActions.clear();</span><br><span class="line">        MaxAction.clear();</span><br><span class="line">        Has_Init=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Visited.add(stataObs);</span><br><span class="line">    <span class="type">StateObservation</span> <span class="variable">stCopy</span> <span class="operator">=</span> stataObs.copy();</span><br><span class="line">    ArrayList&lt;Types.ACTIONS&gt; actions = stataObs.getAvailableActions();</span><br><span class="line">    <span class="keyword">for</span>(Types.ACTIONS action:actions) &#123;</span><br><span class="line">        stCopy.advance(action);</span><br><span class="line">        DFSActions.add(action);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(CheckifVisited(stCopy))&#123;</span><br><span class="line">            stCopy=stataObs.copy();</span><br><span class="line">            DFSActions.remove(DFSActions.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (stCopy.getGameWinner() == Types.WINNER.PLAYER_WINS) &#123;</span><br><span class="line">            <span class="type">int</span> score=heuristic(stCopy);</span><br><span class="line">            <span class="keyword">if</span>(score&gt;MaxScore)&#123;</span><br><span class="line">                MaxScore=score;</span><br><span class="line">                MaxAction= (ArrayList&lt;Types.ACTIONS&gt;) DFSActions.clone();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            stCopy=stataObs.copy();</span><br><span class="line">            DFSActions.remove(DFSActions.size()-<span class="number">1</span>);</span><br><span class="line">            Has_Init=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            LFS(stCopy,elapsedTimer,dep+<span class="number">1</span>);</span><br><span class="line">            Visited.remove(stCopy);</span><br><span class="line">            stCopy=stataObs.copy();</span><br><span class="line">            DFSActions.remove(DFSActions.size()-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>c</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">act</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span></span></span></span>函数里，也根据<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>a</mi><mi>s</mi><mi mathvariant="normal">_</mi><mi>I</mi><mi>n</mi><mi>i</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">Has\_Init</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.99333em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span></span></span></span>开关的不同施行不同的造作：</p>
<ul>
<li>如果没初始化，则意味着现在需要搜索一遍，即进入<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>F</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">LFs</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault">s</span></span></span></span>函数</li>
<li>如果已经搜索过了，那么依次执行搜索好的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>A</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>L</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">BestActionList</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">A</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span></span></span></span>就可以了。</li>
</ul>
<hr>
<h3 id="2-2-3-task2-完整代码展示">2.2.3 TASK2 完整代码展示</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers.dls;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics2D;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> core.game.ForwardModel;</span><br><span class="line"><span class="keyword">import</span> core.game.Observation;</span><br><span class="line"><span class="keyword">import</span> core.game.StateObservation;</span><br><span class="line"><span class="keyword">import</span> core.player.AbstractPlayer;</span><br><span class="line"><span class="keyword">import</span> ontology.Types;</span><br><span class="line"><span class="keyword">import</span> ontology.avatar.MovingAvatar;</span><br><span class="line"><span class="keyword">import</span> tools.ElapsedCpuTimer;</span><br><span class="line"><span class="keyword">import</span> tools.Vector2d;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Agent</span> <span class="keyword">extends</span> <span class="title class_">AbstractPlayer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Random randomGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> ArrayList&lt;Observation&gt; grid[][];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> block_size,numstep=<span class="number">0</span>,MaxScore=-<span class="number">10000000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> OK=<span class="literal">false</span>,Has_Init=<span class="literal">false</span>,KKK=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> MaxDepth=<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;StateObservation&gt; Visited= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;StateObservation&gt;();</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Types.ACTIONS&gt;  DFSActions= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Types.ACTIONS&gt;(),MaxAction= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Types.ACTIONS&gt;();</span><br><span class="line">    <span class="keyword">private</span> Vector2d goalpos,keypos;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Public constructor with state observation and time due.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> so state observation of the current game.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> elapsedTimer Timer for the controller creation.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Agent</span><span class="params">(StateObservation so, ElapsedCpuTimer elapsedTimer)</span></span><br><span class="line">    &#123;</span><br><span class="line">        randomGenerator = <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        grid = so.getObservationGrid();</span><br><span class="line">        block_size = so.getBlockSize();</span><br><span class="line">        ArrayList&lt;Observation&gt;[] fixedPositions = so.getImmovablePositions();</span><br><span class="line">        ArrayList&lt;Observation&gt;[] movingPositions = so.getMovablePositions();</span><br><span class="line">        goalpos = fixedPositions[<span class="number">1</span>].get(<span class="number">0</span>).position; <span class="comment">//目标的坐标</span></span><br><span class="line">        keypos = movingPositions[<span class="number">0</span>].get(<span class="number">0</span>).position ;<span class="comment">//钥匙的坐标</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//检查是否走过</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">CheckifVisited</span><span class="params">(StateObservation stataObs)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Visited.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (stataObs.equalPosition(Visited.get(i))) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取箱子的坐标</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Vector2d&gt; <span class="title function_">GetBox</span><span class="params">(StateObservation stataObs)</span>&#123;</span><br><span class="line">        ArrayList&lt;Observation&gt;[][] observationGrid= stataObs.getObservationGrid();</span><br><span class="line">        ArrayList&lt;Vector2d&gt; Box= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;tools.Vector2d&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;observationGrid.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;observationGrid[i].length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(observationGrid[i][j]!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;observationGrid[i][j].size();k++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(observationGrid[i][j].get(k).itype==<span class="number">8</span>)&#123;</span><br><span class="line">                            Box.add(observationGrid[i][j].get(k).position);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Box;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取钥匙的坐标</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Vector2d&gt; <span class="title function_">Getkey</span><span class="params">(StateObservation stataObs)</span>&#123;</span><br><span class="line">        ArrayList&lt;Observation&gt;[][] observationGrid= stataObs.getObservationGrid();</span><br><span class="line">        ArrayList&lt;Vector2d&gt; Key= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;tools.Vector2d&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;observationGrid.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;observationGrid[i].length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(observationGrid[i][j]!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;observationGrid[i][j].size();k++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(observationGrid[i][j].get(k).itype==<span class="number">6</span>)&#123;</span><br><span class="line">                            Key.add(observationGrid[i][j].get(k).position);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Key;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//得到两点的曼哈顿距离</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">GetDistance</span><span class="params">(Vector2d a,Vector2d b)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)Math.abs(a.x-b.x)/<span class="number">50</span>+(<span class="type">int</span>)Math.abs(a.y-b.y)/<span class="number">50</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//启发式估价函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">heuristic</span><span class="params">(StateObservation stateObs)</span>&#123;</span><br><span class="line">        <span class="type">int</span> score=<span class="number">0</span>;</span><br><span class="line">        ArrayList&lt;Observation&gt;[] movingPositions = stateObs.getMovablePositions();</span><br><span class="line">        <span class="keyword">if</span>(stateObs.getGameWinner()==Types.WINNER.PLAYER_WINS)&#123;</span><br><span class="line">            score+=<span class="number">1000000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(stateObs.getGameWinner()==Types.WINNER.PLAYER_LOSES)&#123;</span><br><span class="line">            score-=<span class="number">1000000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        score+=(<span class="type">int</span>)stateObs.getGameScore()*<span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> flag=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Visited.size();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(keypos.equals(stateObs.getAvatarPosition()))&#123;</span><br><span class="line">                flag=<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(keypos.equals(stateObs.getAvatarPosition())) flag=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(flag&amp;&amp;KKK) score+=<span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Getkey(stateObs).isEmpty())&#123;</span><br><span class="line">            score-=GetDistance(stateObs.getAvatarPosition(),goalpos);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(GetBox(stateObs).contains(keypos)) score-=<span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line">            score-=GetDistance(stateObs.getAvatarPosition(),keypos);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">LFS</span><span class="params">(StateObservation stataObs, ElapsedCpuTimer elapsedTimer,<span class="type">int</span> dep)</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(dep==MaxDepth||stataObs.getGameWinner()==Types.WINNER.PLAYER_WINS)&#123;</span><br><span class="line">            <span class="type">int</span> score=heuristic(stataObs);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(score&gt;MaxScore)&#123;</span><br><span class="line">                MaxScore=score;</span><br><span class="line">                MaxAction= (ArrayList&lt;Types.ACTIONS&gt;) DFSActions.clone();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Has_Init)&#123;</span><br><span class="line">            <span class="keyword">if</span>(CheckifVisited(stataObs))&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            Visited.clear();</span><br><span class="line">            DFSActions.clear();</span><br><span class="line">            MaxAction.clear();</span><br><span class="line">            Has_Init=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Visited.add(stataObs);</span><br><span class="line">        <span class="type">StateObservation</span> <span class="variable">stCopy</span> <span class="operator">=</span> stataObs.copy();</span><br><span class="line">        ArrayList&lt;Types.ACTIONS&gt; actions = stataObs.getAvailableActions();</span><br><span class="line">        <span class="keyword">for</span>(Types.ACTIONS action:actions) &#123;</span><br><span class="line">            stCopy.advance(action);</span><br><span class="line">            DFSActions.add(action);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(CheckifVisited(stCopy))&#123;</span><br><span class="line">                stCopy=stataObs.copy();</span><br><span class="line">                DFSActions.remove(DFSActions.size()-<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (stCopy.getGameWinner() == Types.WINNER.PLAYER_WINS) &#123;</span><br><span class="line">    </span><br><span class="line">                <span class="type">int</span> score=heuristic(stCopy);</span><br><span class="line">                <span class="keyword">if</span>(score&gt;MaxScore)&#123;</span><br><span class="line">                    MaxScore=score;</span><br><span class="line">                    MaxAction= (ArrayList&lt;Types.ACTIONS&gt;) DFSActions.clone();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                stCopy=stataObs.copy();</span><br><span class="line">                DFSActions.remove(DFSActions.size()-<span class="number">1</span>);</span><br><span class="line">                Has_Init=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                LFS(stCopy,elapsedTimer,dep+<span class="number">1</span>);</span><br><span class="line">                Visited.remove(stCopy);</span><br><span class="line">                stCopy=stataObs.copy();</span><br><span class="line">                DFSActions.remove(DFSActions.size()-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Types.ACTIONS <span class="title function_">act</span><span class="params">(StateObservation stateObs, ElapsedCpuTimer elapsedTimer)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(Has_Init)&#123;</span><br><span class="line">            numstep++;<span class="type">int</span> now=numstep;</span><br><span class="line">            <span class="keyword">if</span>(numstep&gt;MaxAction.size()-<span class="number">1</span>)&#123;</span><br><span class="line">                Has_Init=<span class="literal">false</span>;numstep=<span class="number">0</span>;MaxScore=-<span class="number">100000</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> MaxAction.get(now);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!Getkey(stateObs).isEmpty()) KKK=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">else</span> KKK=<span class="literal">false</span>;MaxScore=-<span class="number">10000000</span>;</span><br><span class="line">        System.out.println(stateObs.getAvatarPosition());</span><br><span class="line">        LFS(stateObs,elapsedTimer,<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;MaxScore= &quot;</span> + MaxScore + <span class="string">&quot; &quot;</span> +  MaxAction.size());</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;MaxAction.size();i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;action &quot;</span> + MaxAction.get(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(MaxAction.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;action nil&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> Types.ACTIONS.ACTION_NIL;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> MaxAction.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">printDebug</span><span class="params">(ArrayList&lt;Observation&gt;[] positions, String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (positions != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.print(str + <span class="string">&quot;:&quot;</span> + positions.length + <span class="string">&quot;(&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; positions.length; i++) &#123;</span><br><span class="line">                System.out.print(positions[i].size() + <span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(<span class="string">&quot;); &quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;positions.length;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;positions[i].size();j++)&#123;</span><br><span class="line">                    System.out.println(str + <span class="string">&quot; x=&quot;</span> + positions[i].get(j).position.x/<span class="number">50</span> + <span class="string">&quot; y=&quot;</span> + positions[i].get(j).position.y/<span class="number">50</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> System.out.print(str + <span class="string">&quot;: 0; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-4-algorithm-performance">2.2.4 Algorithm Performance</h3>
<p>程序的执行效果与各项参数密切相关，首先是各项启发式函数的系数常数，经过调整得到以下参数：</p>
<ul>
<li>
<p>赢得游戏 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>+</mo><mn>1</mn><mo>∗</mo><msub><mi>W</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mn>100000</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">score + 1*W_1(100000)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>丢失游戏 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>−</mo><mn>1</mn><mo>∗</mo><msub><mi>W</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mn>100000</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">score - 1*W_2(100000)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>计算得分 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>+</mo><mi>G</mi><mi>e</mi><mi>t</mi><mi>G</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>S</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo>∗</mo><msub><mi>W</mi><mn>3</mn></msub><mo stretchy="false">(</mo><mn>100</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">score + GetGameScore()*W_3(100)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">G</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>得到钥匙 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>+</mo><mn>1</mn><mo>∗</mo><msub><mi>W</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mn>500</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">score + 1*W_1(500)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>箱子推到了钥匙位置上 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>−</mo><msub><mi>W</mi><mn>4</mn></msub><mo stretchy="false">(</mo><mn>100000</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">score - W_4(100000)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>Distance：</p>
<ol>
<li>
<p>拿到钥匙前：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>−</mo><mi>D</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>T</mi><mi>o</mi><mi>K</mi><mi>e</mi><mi>y</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo>∗</mo><msub><mi>W</mi><mn>5</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">score - DistanceToKey()*W_5(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p>
</li>
<li>
<p>拿到钥匙后：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>+</mo><mi>D</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mi>T</mi><mi>o</mi><mi>D</mi><mi>o</mi><mi>o</mi><mi>r</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo><mo>∗</mo><msub><mi>W</mi><mn>6</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">score + DistanceToDoor()*W_6(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p>
</li>
</ol>
</li>
</ul>
<p>另外的一个关键参数是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mi>L</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">MaxDepthLimit</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span></span></span></span>，这个参数十分关键，设小了会导致程序找不到成功的路径(比如距离小到无法在一次搜索中推开箱子拿到钥匙)，设置大了会导致程序运行时间过长，甚至超过单步的时间限制。</p>
<p>经过尝试，设置<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mi>L</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">MaxDepthLimit=3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> 能通过第一关。而设置<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><mi>x</mi><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mi>L</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><mo>=</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">MaxDepthLimit=15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">5</span></span></span></span>能通过第二关。</p>
<hr>
<h2 id="2-3-task3-astar启发式搜索">2.3 Task3: Astar启发式搜索</h2>
<h3 id="2-3-1-a-算法问题概述：">2.3.1 A*算法问题概述：</h3>
<p>本题要求使用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∗</mo></mrow><annotation encoding="application/x-tex">A*</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord">∗</span></span></span></span>算法来解决Bait游戏，在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>F</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">BFS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span>的基础上加入了启发式函数，即每次搜索时，优先搜索启发式函数值最小的节点，这样可以大大提高搜索效率。</p>
<p>其算法的核心在于启发式函数的设定，优秀的启发式函数可以极大程度加速搜索。</p>
<p><strong>在本题中，设定为单步时限<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">100ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">m</span><span class="mord mathdefault">s</span></span></span></span>，经过参数反复打磨与设定，我的程序可以在第1,2,3,5张图中在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">100ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">m</span><span class="mord mathdefault">s</span></span></span></span>内直接找到获胜策略。</strong></p>
<p>设计好了启发式函数后，整体框架其实类似于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>F</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">BFS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span>，只不过在每次搜索时，我们需要优先搜索集合中启发式函数值最小的节点。这一点可以用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mi>a</mi><mi>v</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">java</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span></span></span></span>中的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>S</mi><mi>e</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">TreeSet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span></span></span></span>内置的红黑树加速实现（因为到后期节点数会很多，所以用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>S</mi><mi>e</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">TreeSet</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span></span></span></span>来存储节点可以大幅度优化时间开销）。</p>
<h3 id="2-3-2-启发式函数的设计">2.3.2 启发式函数的设计</h3>
<p>先阐述一下游戏的整体流程：</p>
<p>推动箱子或者填坑 --&gt; 拿到钥匙 --&gt; 推动箱子或者填坑 --&gt; 到达终点</p>
<p>整个过程和箱子的位置、是否拿到钥匙、箱子是否进坑密切相关。</p>
<p>于是自然有以下参数：</p>
<ul>
<li>
<ol start="0">
<li>深度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>p</mi><mo>∗</mo><msub><mi>c</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">Dep*c_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ol>
</li>
<li>
<ol>
<li>游戏得分<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mi>e</mi><mi>t</mi><mi>G</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>S</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>∗</mo><msub><mi>c</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">GetGameScore*c_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">G</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ol>
</li>
<li>
<ol start="2">
<li>是否赢得游戏<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>i</mi><mi>n</mi><mi>o</mi><mi>r</mi><mi>L</mi><mi>o</mi><mi>s</mi><mi>e</mi><mo>∗</mo><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">WinorLose*c_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">L</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ol>
</li>
<li>
<ol start="3">
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>∗</mo><msub><mi>c</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">Distance*c_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> （拿到钥匙前Distance为到钥匙的距离，拿到钥匙后Distance为到终点的距离）</li>
</ol>
</li>
</ul>
<p>看起来现在的启发式函数会直奔钥匙并保证不会掉坑里并且会选择得分高的方式（推箱子入坑，吃蘑菇等），但是在第二张图中会出现下面的情况：</p>
<p><img src="007.png" alt="Alt text"></p>
<p>即不会往两边的箱子走，因为往两边走意味着远离钥匙，我们的启发式函数不鼓励我们这样做。</p>
<p>另外是容易出现推箱子进入死角的情况。</p>
<p>为了避免上述两种不利情况，我们为箱子单独增加参数：</p>
<p>理论上，我们需要为每一个box都计算一个单独但是权值，但是实际上因为走一步影响的box有限，故只需统计走一步能影响到的box数就可以。形式化的，即我们只对于当前精灵位置曼哈顿距离小于等于二的box进行权值计算。</p>
<ul>
<li>4.1 自由度<span class='katex-error' title='ParseError: KaTeX parse error: Double subscript at position 5: *C_4_̲1'>*C_4_1</span> （自由度表示箱子左右或者上下都是空的，自由度越大，箱子越容易被推动，值为0/1/2）</li>
<li>4.2 离当前box最近的坑的距离<span class='katex-error' title='ParseError: KaTeX parse error: Double subscript at position 5: *C_4_̲2'>*C_4_2</span> (我们期望推着箱子往坑走)</li>
<li>4.3 是否可以一步入洞，即箱子的一侧是精灵对侧是坑<span class='katex-error' title='ParseError: KaTeX parse error: Double subscript at position 5: *C_4_̲3'>*C_4_3</span>（这种情况我们期望把箱子推进坑）</li>
<li>4.4 是否挡住了钥匙<span class='katex-error' title='ParseError: KaTeX parse error: Double subscript at position 5: *C_4_̲4'>*C_4_4</span>（这种情况赋很大的负权值直接毙掉就可以）</li>
</ul>
<p>上述参数可以有效解决箱子进入死角或者推着箱子乱走的情况。</p>
<p>同时，对于精灵，我们要引导其往箱子走。</p>
<ul>
<li>5 与精灵最近的box距离<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∗</mo><msub><mi>C</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">*C_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord">∗</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> （我们期望精灵往箱子走）</li>
</ul>
<p>至此，启发式函数的设计已经完成。剩下的工作是对于每个参数赋予合适的权值。（炼丹太痛苦了</p>
<p>经过反复调试，我最终得到的参数如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> W_0=-<span class="number">2</span>,W_1=<span class="number">100</span>,W_2=<span class="number">100000000</span>,W_3=-<span class="number">5</span>,W_4_1=<span class="number">30</span>,W_4_2=<span class="number">10</span>,W_4_3=<span class="number">1000</span>,W_4_4=-<span class="number">10000000</span>,W_5=-<span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>并成功在总时间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">100ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">m</span><span class="mord mathdefault">s</span></span></span></span>内通过了第1,2,3,5张图。（远远比要求的单步<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">100ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">m</span><span class="mord mathdefault">s</span></span></span></span>优秀。</p>
<p>code如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">double</span> <span class="title function_">heuristic</span><span class="params">(StateObservation stateObs,<span class="type">boolean</span> HasGetKey,<span class="type">int</span> dep)</span>&#123;</span><br><span class="line">    <span class="type">double</span> score=<span class="number">0</span>,W_0=-<span class="number">2</span>,W_1=<span class="number">100000000</span>,W_2=<span class="number">100</span>,W_3=-<span class="number">5</span>,W_4_1=<span class="number">30</span>,W_4_2=<span class="number">10</span>,W_4_3=<span class="number">1000</span>,W_4_4=-<span class="number">10</span>,W_5=-<span class="number">10</span>;</span><br><span class="line">    <span class="type">double</span> Dep,WinorLose=<span class="number">0</span>,Nowscore=<span class="number">0</span>,Distance,Box_1=<span class="number">0</span>,Box_2=<span class="number">0</span>,Box_3=<span class="number">0</span>,Box_4=<span class="number">0</span>,GG=<span class="number">0</span>,MinDistanceBox=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    Dep=dep;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(stateObs.getGameWinner()==Types.WINNER.PLAYER_WINS)&#123;</span><br><span class="line">        WinorLose=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(stateObs.getGameWinner()==Types.WINNER.PLAYER_LOSES)&#123;</span><br><span class="line">        WinorLose=-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Nowscore=stateObs.getGameScore();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(HasGetKey)&#123;</span><br><span class="line">        Distance=GetDistance(stateObs.getAvatarPosition(),goalpos);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        Distance=GetDistance(stateObs.getAvatarPosition(),keypos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;Vector2d&gt; Box=GetBox(stateObs);</span><br><span class="line">    ArrayList&lt;Observation&gt;[][] observationGrid= stateObs.getObservationGrid();</span><br><span class="line">    <span class="type">int</span>[][] Map=<span class="keyword">new</span> <span class="title class_">int</span>[observationGrid.length][observationGrid[<span class="number">0</span>].length];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;observationGrid.length;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;observationGrid[i].length;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(observationGrid[i][j].size()!=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;observationGrid[i][j].size();k++)&#123;</span><br><span class="line">                    Map[i][j]=observationGrid[i][j].get(k).itype;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                Map[i][j]=-<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ax=(<span class="type">int</span>)stateObs.getAvatarPosition().x/<span class="number">50</span>,ay=(<span class="type">int</span>)stateObs.getAvatarPosition().y/<span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Box.size();i++)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> x=(<span class="type">int</span>)Box.get(i).x/<span class="number">50</span>,y=(<span class="type">int</span>)Box.get(i).y/<span class="number">50</span>;</span><br><span class="line">        <span class="type">int</span> n=observationGrid.length,m=observationGrid[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(x==keypos.x/<span class="number">50</span>&amp;&amp;y==keypos.y/<span class="number">50</span>&amp;&amp; !HasGetKey) GG=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> is=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(ax==x&amp;&amp;(ay==y+<span class="number">1</span>||ay==y-<span class="number">1</span>)) is=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(ay==y&amp;&amp;(ax==x+<span class="number">1</span>||ax==x-<span class="number">1</span>)) is=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(ax==x-<span class="number">1</span>&amp;&amp;ay==y-<span class="number">1</span>) is=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(ax==x+<span class="number">1</span>&amp;&amp;ay==y+<span class="number">1</span>) is=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(ax==x-<span class="number">1</span>&amp;&amp;ay==y+<span class="number">1</span>) is=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(ax==x+<span class="number">1</span>&amp;&amp;ay==y-<span class="number">1</span>) is=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(!is) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(x&lt;n-<span class="number">1</span>&amp;&amp;x&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(Map[x+<span class="number">1</span>][y]==-<span class="number">1</span>&amp;&amp;Map[x-<span class="number">1</span>][y]==-<span class="number">1</span>) Box_1++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(y&lt;m-<span class="number">1</span>&amp;&amp;y&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(Map[x][y+<span class="number">1</span>]==-<span class="number">1</span>&amp;&amp;Map[x][y-<span class="number">1</span>]==-<span class="number">1</span>) Box_1++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(x&lt;n-<span class="number">1</span>) <span class="keyword">if</span>(Map[x+<span class="number">1</span>][y]==<span class="number">2</span>) Box_2++;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;<span class="number">0</span>) <span class="keyword">if</span>(Map[x-<span class="number">1</span>][y]==<span class="number">2</span>) Box_2++;</span><br><span class="line">        <span class="keyword">if</span>(y&lt;m-<span class="number">1</span>) <span class="keyword">if</span>(Map[x][y+<span class="number">1</span>]==<span class="number">2</span>) Box_2++;</span><br><span class="line">        <span class="keyword">if</span>(y&gt;<span class="number">0</span>) <span class="keyword">if</span>(Map[x][y-<span class="number">1</span>]==<span class="number">2</span>) Box_2++;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(x&lt;n-<span class="number">1</span>&amp;&amp;x&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(Map[x+<span class="number">1</span>][y]==<span class="number">2</span>&amp;&amp;Map[x-<span class="number">1</span>][y]==-<span class="number">1</span>) Box_3++;</span><br><span class="line">            <span class="keyword">if</span>(Map[x-<span class="number">1</span>][y]==<span class="number">2</span>&amp;&amp;Map[x+<span class="number">1</span>][y]==<span class="number">1</span>) Box_3++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(y&lt;m-<span class="number">1</span>&amp;&amp;y&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(Map[x][y+<span class="number">1</span>]==<span class="number">2</span>&amp;&amp;Map[x][y-<span class="number">1</span>]==-<span class="number">1</span>) Box_3++;</span><br><span class="line">            <span class="keyword">if</span>(Map[x][y-<span class="number">1</span>]==<span class="number">2</span>&amp;&amp;Map[x][y+<span class="number">1</span>]==-<span class="number">1</span>) Box_3++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Box_4+=GetDistanceHole(x*<span class="number">50</span>,y*<span class="number">50</span>,stateObs);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(HasGetKey) GG--;</span><br><span class="line"></span><br><span class="line">    MinDistanceBox=GetMinDistanceBox(stateObs);</span><br><span class="line"></span><br><span class="line">    score=W_0*Dep+W_1*WinorLose+W_2*Nowscore+W_3*Distance+W_4_1*Box_1+W_4_2*Box_2+W_4_3*Box_3+W_4_4*Box_4+GG*-<span class="number">1000000</span>+W_5*MinDistanceBox;</span><br><span class="line">    <span class="keyword">return</span> score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-3-a-算法的实现">2.3.3 A*算法的实现</h3>
<p>与在2.3.1概述中说的一样，我们用红黑树数据结构实现。</p>
<p>为了方便代码实现，实现了基础类Node。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">double</span> score, StateObservation stateObs, ArrayList&lt;Types.ACTIONS&gt; Actions, <span class="type">int</span> depth,<span class="type">boolean</span> GetKey)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.score = score;</span><br><span class="line">        <span class="built_in">this</span>.stateObs = stateObs;</span><br><span class="line">        <span class="built_in">this</span>.Actions = Actions;</span><br><span class="line">        <span class="built_in">this</span>.depth = depth;</span><br><span class="line">        <span class="built_in">this</span>.GetKey=GetKey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">score</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span></span></span></span>为启发式函数值，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>O</mi><mi>b</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">stateObs</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">b</span><span class="mord mathdefault">s</span></span></span></span>为当前局面，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">Actions</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span></span></span></span>为当前局面的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>L</mi><mi>i</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">ActionList</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">L</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">depth</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault">h</span></span></span></span>为当前深度，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mi>e</mi><mi>t</mi><mi>K</mi><mi>e</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">GetKey</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span>为是否拿到钥匙。</p>
<p>同时定义红黑树排序关键字是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">score</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span></span></span></span>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Node other)</span> &#123;</span><br><span class="line">    <span class="comment">// 降序排列</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ok</span> <span class="operator">=</span> Double.compare(other.score, <span class="built_in">this</span>.score);</span><br><span class="line">    <span class="keyword">if</span>(ok==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(stateObs.equalPosition(other.stateObs))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> ok;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Astar算法的实现框架代码如下:（和之前两个的框架类似，只不过变成了优先队列展开而已</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Types.ACTIONS&gt; Astar(Node StartNode, ElapsedCpuTimer elapsedTimer,<span class="type">int</span> dep)&#123;</span><br><span class="line">        <span class="type">int</span> tot=<span class="number">0</span>;</span><br><span class="line">        Todolist.add(StartNode);</span><br><span class="line">        <span class="keyword">while</span>(!Todolist.isEmpty())&#123;</span><br><span class="line">            Node now=Todolist.pollFirst();</span><br><span class="line">            System.out.println(<span class="string">&quot;score= &quot;</span> + now.getScore() + <span class="string">&quot; depth= &quot;</span> + now.getDepth() + <span class="string">&quot; GetKey= &quot;</span> + now.GetKey + <span class="string">&quot;Positon= &quot;</span> + (now.getStateObs().getAvatarPosition().x/<span class="number">50</span>)+<span class="string">&quot;,&quot;</span>+(now.getStateObs().getAvatarPosition().y/<span class="number">50</span>)+<span class="string">&quot;-------------&quot;</span>);</span><br><span class="line">            tot++;</span><br><span class="line">            StateObservation stataObs=now.getStateObs();</span><br><span class="line">            Visited.add(stataObs);<span class="comment">//记录走过的节点</span></span><br><span class="line">            ArrayList&lt;Types.ACTIONS&gt; actions = now.getStateObs().getAvailableActions();</span><br><span class="line">            <span class="keyword">for</span>(Types.ACTIONS action:actions)&#123;</span><br><span class="line">                <span class="type">StateObservation</span> <span class="variable">stCopy</span> <span class="operator">=</span> now.getStateObs().copy();</span><br><span class="line">                stCopy.advance(action);</span><br><span class="line">                ArrayList&lt;Types.ACTIONS&gt;  AstarAction= (ArrayList&lt;Types.ACTIONS&gt;) now.getActions().clone();</span><br><span class="line">                AstarAction.add(action);</span><br><span class="line">                <span class="keyword">if</span>(stCopy.getGameWinner()==Types.WINNER.PLAYER_WINS)&#123;</span><br><span class="line">                    OK=<span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">return</span> AstarAction;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(stCopy.getGameWinner()==Types.WINNER.PLAYER_LOSES||CheckifVisited(stCopy))&#123;</span><br><span class="line">                    AstarAction.remove(AstarAction.size()-<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//判断是否取得了钥匙</span></span><br><span class="line">                <span class="type">boolean</span> NowGetKey=<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span>(Getkey(now.getStateObs()).size()==<span class="number">1</span>&amp;&amp; Getkey(stCopy).isEmpty())&#123;</span><br><span class="line">                    NowGetKey=<span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//如果Todolist有该位置的节点，比较两个节点的score，取最优的</span></span><br><span class="line">                Node node=contain(Todolist,stCopy);</span><br><span class="line">                <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="type">double</span> score0=node.getScore();</span><br><span class="line"></span><br><span class="line">                    <span class="type">double</span> score1=heuristic(stCopy,NowGetKey|now.GetKey,dep+<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">if</span>(score0&gt;=score1)&#123;</span><br><span class="line">                        AstarAction.remove(AstarAction.size()-<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        Node Newnode=<span class="keyword">new</span> <span class="title class_">Node</span>(score1,stCopy,AstarAction, dep+<span class="number">1</span>,NowGetKey|now.GetKey);</span><br><span class="line">                        Todolist.remove(node);</span><br><span class="line">                        Todolist.add(Newnode);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//反之，则加入红黑树中排序</span></span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    Node Newnode=<span class="keyword">new</span> <span class="title class_">Node</span>(heuristic(stCopy,NowGetKey|now.GetKey,dep+<span class="number">1</span>),stCopy,AstarAction, dep+<span class="number">1</span>,NowGetKey|now.GetKey);</span><br><span class="line">                    Todolist.add(Newnode);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;GGGGGGGGGGGGGGGGGGGGGGG&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Types.ACTIONS&gt;());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-3-4-task3-完整代码展示">2.3.4 TASK3 完整代码展示</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers.Astar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> core.game.Observation;</span><br><span class="line"><span class="keyword">import</span> core.game.StateObservation;</span><br><span class="line"><span class="keyword">import</span> core.player.AbstractPlayer;</span><br><span class="line"><span class="keyword">import</span> ontology.Types;</span><br><span class="line"><span class="keyword">import</span> tools.ElapsedCpuTimer;</span><br><span class="line"><span class="keyword">import</span> tools.Vector2d;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Double.min;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Node类用于描述一个状态，包括状态的得分、状态本身、状态的动作、状态的深度、是否拿过钥匙</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Node&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> score;</span><br><span class="line">    <span class="keyword">private</span> StateObservation stateObs;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Types.ACTIONS&gt; Actions;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> depth;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> GetKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">double</span> score, StateObservation stateObs, ArrayList&lt;Types.ACTIONS&gt; Actions, <span class="type">int</span> depth,<span class="type">boolean</span> GetKey)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.score = score;</span><br><span class="line">        <span class="built_in">this</span>.stateObs = stateObs;</span><br><span class="line">        <span class="built_in">this</span>.Actions = Actions;</span><br><span class="line">        <span class="built_in">this</span>.depth = depth;</span><br><span class="line">        <span class="built_in">this</span>.GetKey=GetKey;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Node other)</span> &#123;</span><br><span class="line">        System.out.println(other.stateObs==<span class="literal">null</span>);</span><br><span class="line">        <span class="built_in">this</span>.score = other.score;</span><br><span class="line">        <span class="built_in">this</span>.stateObs = stateObs.copy(); <span class="comment">// 假设stateObs也需要克隆</span></span><br><span class="line">        <span class="built_in">this</span>.Actions = (ArrayList&lt;Types.ACTIONS&gt;) other.Actions.clone(); <span class="comment">// 假设Actions也需要克隆</span></span><br><span class="line">        <span class="built_in">this</span>.depth = other.depth;</span><br><span class="line">        <span class="built_in">this</span>.GetKey=other.GetKey;</span><br><span class="line">        <span class="comment">// 复制其他属性</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getScore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> StateObservation <span class="title function_">getStateObs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stateObs;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> ArrayList&lt;Types.ACTIONS&gt; getActions() &#123;</span><br><span class="line">        <span class="keyword">return</span> Actions;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getDepth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> depth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//排序按照score启发式得分降序排序</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Node other)</span> &#123;</span><br><span class="line">        <span class="comment">// 降序排列</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">ok</span> <span class="operator">=</span> Double.compare(other.score, <span class="built_in">this</span>.score);</span><br><span class="line">        <span class="keyword">if</span>(ok==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(stateObs.equalPosition(other.stateObs))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> ok;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">other</span> <span class="operator">=</span> (Node) o;</span><br><span class="line">        <span class="keyword">return</span> stateObs.equalPosition(other.stateObs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Double.toString(score);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Agent</span> <span class="keyword">extends</span> <span class="title class_">AbstractPlayer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Random randomGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> ArrayList&lt;Observation&gt; grid[][];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TreeSet&lt;Node&gt; Todolist = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> OK=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> block_size,numstep=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;StateObservation&gt; Visited= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;StateObservation&gt;();</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Types.ACTIONS&gt;  MaxAction= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Types.ACTIONS&gt;();</span><br><span class="line">    <span class="keyword">private</span> Vector2d goalpos,keypos;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Agent</span><span class="params">(StateObservation so, ElapsedCpuTimer elapsedTimer)</span></span><br><span class="line">    &#123;</span><br><span class="line">        randomGenerator = <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        grid = so.getObservationGrid();</span><br><span class="line">        block_size = so.getBlockSize();</span><br><span class="line">        ArrayList&lt;Observation&gt;[] fixedPositions = so.getImmovablePositions();</span><br><span class="line">        ArrayList&lt;Observation&gt;[] movingPositions = so.getMovablePositions();</span><br><span class="line">        goalpos = fixedPositions[<span class="number">1</span>].get(<span class="number">0</span>).position; <span class="comment">//目标的坐标</span></span><br><span class="line">        keypos = movingPositions[<span class="number">0</span>].get(<span class="number">0</span>).position ;<span class="comment">//钥匙的坐标</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//检查是否走过相同的状态</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">CheckifVisited</span><span class="params">(StateObservation stataObs)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; Visited.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (stataObs.equalPosition(Visited.get(i))) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得两点的距离</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">GetDistance</span><span class="params">(Vector2d a,Vector2d b)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)Math.abs(a.x-b.x)/<span class="number">50</span>+(<span class="type">int</span>)Math.abs(a.y-b.y)/<span class="number">50</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//检查openlist是否走过相同的状态</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">contain</span><span class="params">(TreeSet&lt;Node&gt; Todolist,StateObservation stataObs)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(Node node:Todolist)&#123;</span><br><span class="line">            <span class="keyword">if</span>(node.getStateObs().equalPosition(stataObs))&#123;</span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Vector2d&gt; <span class="title function_">GetBox</span><span class="params">(StateObservation stataObs)</span>&#123;</span><br><span class="line">        ArrayList&lt;Observation&gt;[][] observationGrid= stataObs.getObservationGrid();</span><br><span class="line">        ArrayList&lt;Vector2d&gt; Box= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;tools.Vector2d&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;observationGrid.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;observationGrid[i].length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(observationGrid[i][j]!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;observationGrid[i][j].size();k++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(observationGrid[i][j].get(k).itype==<span class="number">8</span>)&#123;</span><br><span class="line">                            Box.add(observationGrid[i][j].get(k).position);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Box;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到与box最近的坑的距离</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">GetDistanceHole</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,StateObservation stateObs)</span>&#123;</span><br><span class="line">        ArrayList&lt;Observation&gt;[][] observationGrid= stateObs.getObservationGrid();</span><br><span class="line">        <span class="type">int</span> n=observationGrid.length,m=observationGrid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">double</span> sum=<span class="number">1e9</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;m;j++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;observationGrid[i][j].size();k++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(observationGrid[i][j].get(k).itype==<span class="number">2</span>)&#123;</span><br><span class="line">                        sum=min(sum,GetDistance(<span class="keyword">new</span> <span class="title class_">Vector2d</span>(x,y),observationGrid[i][j].get(k).position));</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum==<span class="number">1e9</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> sum;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到与精灵最近的额box的距离</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">GetMinDistanceBox</span><span class="params">(StateObservation stateObs)</span>&#123;</span><br><span class="line">        ArrayList&lt;Observation&gt;[][] observationGrid= stateObs.getObservationGrid();</span><br><span class="line">        ArrayList&lt;Vector2d&gt; Box= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;tools.Vector2d&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;observationGrid.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;observationGrid[i].length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(observationGrid[i][j]!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;observationGrid[i][j].size();k++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(observationGrid[i][j].get(k).itype==<span class="number">8</span>)&#123;</span><br><span class="line">                            Box.add(observationGrid[i][j].get(k).position);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">double</span> sum=<span class="number">1e9</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Box.size();i++)&#123;</span><br><span class="line">            sum=min(sum,GetDistance(stateObs.getAvatarPosition(),Box.get(i)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(sum==<span class="number">1e9</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到key的坐标集合</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;Vector2d&gt; <span class="title function_">Getkey</span><span class="params">(StateObservation stataObs)</span>&#123;</span><br><span class="line">        ArrayList&lt;Observation&gt;[][] observationGrid= stataObs.getObservationGrid();</span><br><span class="line">        ArrayList&lt;Vector2d&gt; Key= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;tools.Vector2d&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;observationGrid.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;observationGrid[i].length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(observationGrid[i][j]!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;observationGrid[i][j].size();k++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(observationGrid[i][j].get(k).itype==<span class="number">6</span>)&#123;</span><br><span class="line">                            Key.add(observationGrid[i][j].get(k).position);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//启发式函数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">heuristic</span><span class="params">(StateObservation stateObs,<span class="type">boolean</span> HasGetKey,<span class="type">int</span> dep)</span>&#123;</span><br><span class="line">        <span class="type">double</span> score=<span class="number">0</span>,W_0=<span class="number">0</span>,W_1=<span class="number">100000000</span>,W_2=<span class="number">100</span>,W_3=-<span class="number">5</span>,W_4_1=<span class="number">30</span>,W_4_2=<span class="number">10</span>,W_4_3=<span class="number">1000</span>,W_4_4=-<span class="number">10</span>,W_5=-<span class="number">10</span>;</span><br><span class="line">        <span class="type">double</span> Dep,WinorLose=<span class="number">0</span>,Nowscore=<span class="number">0</span>,Distance,Box_1=<span class="number">0</span>,Box_2=<span class="number">0</span>,Box_3=<span class="number">0</span>,Box_4=<span class="number">0</span>,GG=<span class="number">0</span>,MinDistanceBox=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        Dep=dep;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(stateObs.getGameWinner()==Types.WINNER.PLAYER_WINS)&#123;</span><br><span class="line">            WinorLose=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(stateObs.getGameWinner()==Types.WINNER.PLAYER_LOSES)&#123;</span><br><span class="line">            WinorLose=-<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Nowscore=stateObs.getGameScore();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(HasGetKey)&#123;</span><br><span class="line">            Distance=GetDistance(stateObs.getAvatarPosition(),goalpos);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            Distance=GetDistance(stateObs.getAvatarPosition(),keypos);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Vector2d&gt; Box=GetBox(stateObs);</span><br><span class="line">        ArrayList&lt;Observation&gt;[][] observationGrid= stateObs.getObservationGrid();</span><br><span class="line">        <span class="type">int</span>[][] Map=<span class="keyword">new</span> <span class="title class_">int</span>[observationGrid.length][observationGrid[<span class="number">0</span>].length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;observationGrid.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;observationGrid[i].length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(observationGrid[i][j].size()!=<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;observationGrid[i][j].size();k++)&#123;</span><br><span class="line">                        Map[i][j]=observationGrid[i][j].get(k).itype;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    Map[i][j]=-<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> ax=(<span class="type">int</span>)stateObs.getAvatarPosition().x/<span class="number">50</span>,ay=(<span class="type">int</span>)stateObs.getAvatarPosition().y/<span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;Box.size();i++)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> x=(<span class="type">int</span>)Box.get(i).x/<span class="number">50</span>,y=(<span class="type">int</span>)Box.get(i).y/<span class="number">50</span>;</span><br><span class="line">            <span class="type">int</span> n=observationGrid.length,m=observationGrid[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(x==keypos.x/<span class="number">50</span>&amp;&amp;y==keypos.y/<span class="number">50</span>&amp;&amp; !HasGetKey) GG=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">boolean</span> is=<span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span>(ax==x&amp;&amp;(ay==y+<span class="number">1</span>||ay==y-<span class="number">1</span>)) is=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(ay==y&amp;&amp;(ax==x+<span class="number">1</span>||ax==x-<span class="number">1</span>)) is=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(ax==x-<span class="number">1</span>&amp;&amp;ay==y-<span class="number">1</span>) is=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(ax==x+<span class="number">1</span>&amp;&amp;ay==y+<span class="number">1</span>) is=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(ax==x-<span class="number">1</span>&amp;&amp;ay==y+<span class="number">1</span>) is=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(ax==x+<span class="number">1</span>&amp;&amp;ay==y-<span class="number">1</span>) is=<span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(!is) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(x&lt;n-<span class="number">1</span>&amp;&amp;x&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(Map[x+<span class="number">1</span>][y]==-<span class="number">1</span>&amp;&amp;Map[x-<span class="number">1</span>][y]==-<span class="number">1</span>) Box_1++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(y&lt;m-<span class="number">1</span>&amp;&amp;y&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(Map[x][y+<span class="number">1</span>]==-<span class="number">1</span>&amp;&amp;Map[x][y-<span class="number">1</span>]==-<span class="number">1</span>) Box_1++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(x&lt;n-<span class="number">1</span>) <span class="keyword">if</span>(Map[x+<span class="number">1</span>][y]==<span class="number">2</span>) Box_2++;</span><br><span class="line">            <span class="keyword">if</span>(x&gt;<span class="number">0</span>) <span class="keyword">if</span>(Map[x-<span class="number">1</span>][y]==<span class="number">2</span>) Box_2++;</span><br><span class="line">            <span class="keyword">if</span>(y&lt;m-<span class="number">1</span>) <span class="keyword">if</span>(Map[x][y+<span class="number">1</span>]==<span class="number">2</span>) Box_2++;</span><br><span class="line">            <span class="keyword">if</span>(y&gt;<span class="number">0</span>) <span class="keyword">if</span>(Map[x][y-<span class="number">1</span>]==<span class="number">2</span>) Box_2++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(x&lt;n-<span class="number">1</span>&amp;&amp;x&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(Map[x+<span class="number">1</span>][y]==<span class="number">2</span>&amp;&amp;Map[x-<span class="number">1</span>][y]==-<span class="number">1</span>) Box_3++;</span><br><span class="line">                <span class="keyword">if</span>(Map[x-<span class="number">1</span>][y]==<span class="number">2</span>&amp;&amp;Map[x+<span class="number">1</span>][y]==<span class="number">1</span>) Box_3++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(y&lt;m-<span class="number">1</span>&amp;&amp;y&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(Map[x][y+<span class="number">1</span>]==<span class="number">2</span>&amp;&amp;Map[x][y-<span class="number">1</span>]==-<span class="number">1</span>) Box_3++;</span><br><span class="line">                <span class="keyword">if</span>(Map[x][y-<span class="number">1</span>]==<span class="number">2</span>&amp;&amp;Map[x][y+<span class="number">1</span>]==-<span class="number">1</span>) Box_3++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Box_4+=GetDistanceHole(x*<span class="number">50</span>,y*<span class="number">50</span>,stateObs);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(HasGetKey) GG--;</span><br><span class="line"></span><br><span class="line">        MinDistanceBox=GetMinDistanceBox(stateObs);</span><br><span class="line"></span><br><span class="line">        score=W_0*Dep+W_1*WinorLose+W_2*Nowscore+W_3*Distance+W_4_1*Box_1+W_4_2*Box_2+W_4_3*Box_3+W_4_4*Box_4+GG*-<span class="number">1000000</span>+W_5*MinDistanceBox;</span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">    ArrayList&lt;Types.ACTIONS&gt; Astar(Node StartNode, ElapsedCpuTimer elapsedTimer,<span class="type">int</span> dep)&#123;</span><br><span class="line">        <span class="type">int</span> tot=<span class="number">0</span>;</span><br><span class="line">        Todolist.add(StartNode);</span><br><span class="line">        <span class="keyword">while</span>(!Todolist.isEmpty())&#123;</span><br><span class="line">            Node now=Todolist.pollFirst();</span><br><span class="line">            System.out.println(<span class="string">&quot;score= &quot;</span> + now.getScore() + <span class="string">&quot; depth= &quot;</span> + now.getDepth() + <span class="string">&quot; GetKey= &quot;</span> + now.GetKey + <span class="string">&quot;Positon= &quot;</span> + (now.getStateObs().getAvatarPosition().x/<span class="number">50</span>)+<span class="string">&quot;,&quot;</span>+(now.getStateObs().getAvatarPosition().y/<span class="number">50</span>)+<span class="string">&quot;-------------&quot;</span>);</span><br><span class="line">            tot++;</span><br><span class="line">            StateObservation stataObs=now.getStateObs();</span><br><span class="line">            Visited.add(stataObs);</span><br><span class="line">            ArrayList&lt;Types.ACTIONS&gt; actions = now.getStateObs().getAvailableActions();</span><br><span class="line">            <span class="keyword">for</span>(Types.ACTIONS action:actions)&#123;</span><br><span class="line">                <span class="type">StateObservation</span> <span class="variable">stCopy</span> <span class="operator">=</span> now.getStateObs().copy();</span><br><span class="line">                stCopy.advance(action);</span><br><span class="line">                ArrayList&lt;Types.ACTIONS&gt;  AstarAction= (ArrayList&lt;Types.ACTIONS&gt;) now.getActions().clone();</span><br><span class="line">                AstarAction.add(action);</span><br><span class="line">                <span class="keyword">if</span>(stCopy.getGameWinner()==Types.WINNER.PLAYER_WINS)&#123;</span><br><span class="line">                    OK=<span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">return</span> AstarAction;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(stCopy.getGameWinner()==Types.WINNER.PLAYER_LOSES||CheckifVisited(stCopy))&#123;</span><br><span class="line">                    AstarAction.remove(AstarAction.size()-<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">boolean</span> NowGetKey=<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span>(Getkey(now.getStateObs()).size()==<span class="number">1</span>&amp;&amp; Getkey(stCopy).isEmpty())&#123;</span><br><span class="line">                    NowGetKey=<span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Node node=contain(Todolist,stCopy);</span><br><span class="line">                <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="type">double</span> score0=node.getScore();</span><br><span class="line"></span><br><span class="line">                    <span class="type">double</span> score1=heuristic(stCopy,NowGetKey|now.GetKey,dep+<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">if</span>(score0&gt;=score1)&#123;</span><br><span class="line">                        AstarAction.remove(AstarAction.size()-<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        Node Newnode=<span class="keyword">new</span> <span class="title class_">Node</span>(score1,stCopy,AstarAction, dep+<span class="number">1</span>,NowGetKey|now.GetKey);</span><br><span class="line">                        Todolist.remove(node);</span><br><span class="line">                        Todolist.add(Newnode);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    Node Newnode=<span class="keyword">new</span> <span class="title class_">Node</span>(heuristic(stCopy,NowGetKey|now.GetKey,dep+<span class="number">1</span>),stCopy,AstarAction, dep+<span class="number">1</span>,NowGetKey|now.GetKey);</span><br><span class="line">                    Todolist.add(Newnode);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;GGGGGGGGGGGGGGGGGGGGGGG&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Types.ACTIONS&gt;());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Types.ACTIONS <span class="title function_">act</span><span class="params">(StateObservation stateObs, ElapsedCpuTimer elapsedTimer)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(OK==<span class="literal">false</span>)&#123;</span><br><span class="line">            Node StartNode=<span class="keyword">new</span> <span class="title class_">Node</span>(heuristic(stateObs,<span class="literal">false</span>,<span class="number">0</span>),stateObs.copy(),<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Types.ACTIONS&gt;(),<span class="number">0</span>,<span class="literal">false</span>);</span><br><span class="line">            MaxAction= Astar(StartNode,elapsedTimer,<span class="number">0</span>);OK=<span class="literal">true</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;AstarAction.size()= &quot;</span> + MaxAction.size());</span><br><span class="line">            <span class="keyword">return</span> MaxAction.get(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            numstep++;</span><br><span class="line">            <span class="keyword">return</span> MaxAction.get(numstep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">printDebug</span><span class="params">(ArrayList&lt;Observation&gt;[] positions, String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (positions != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.print(str + <span class="string">&quot;:&quot;</span> + positions.length + <span class="string">&quot;(&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; positions.length; i++) &#123;</span><br><span class="line">                System.out.print(positions[i].size() + <span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(<span class="string">&quot;); &quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;positions.length;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;positions[i].size();j++)&#123;</span><br><span class="line">                    System.out.println(str + <span class="string">&quot; x=&quot;</span> + positions[i].get(j).position.x/<span class="number">50</span> + <span class="string">&quot; y=&quot;</span> + positions[i].get(j).position.y/<span class="number">50</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> System.out.print(str + <span class="string">&quot;: 0; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-5-algorithm-performance">2.3.5 Algorithm Performance</h3>
<p>至此Astar算法实现完毕，经过测试可以在<strong>总时间</strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">100ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">m</span><span class="mord mathdefault">s</span></span></span></span>内通过第1,2,3,5张图。从结果上证明了参数的设定和权值具有较高的泛化性和可行性。</p>
<p><strong>附图为运用Astar算法在单步100ms通过第一二三五关的截图（虽然设置的是单步，但是其实在第一步（100ms）内就找到了一条正确路径，后续不需要再搜索而是只需要读存好的actionlist就可以了）</strong><br>
<img src="image-1.png" alt=""><br>
<img src="image-2.png" alt="Alt text"><br>
<img src="image-3.png" alt="Alt text"><br>
<img src="image.png" alt="Alt text"></p>
<hr>
<h2 id="2-4-task4：">2.4 TASK4：</h2>
<h3 id="2-4-1-蒙特卡洛树搜索概述">2.4.1 蒙特卡洛树搜索概述</h3>
<p>首先了解一下蒙特卡洛树搜索。</p>
<ol>
<li>
<p><strong>初始化</strong>：</p>
<ul>
<li>创建一个根节点，代表当前的游戏状态或问题。</li>
<li>初始化根节点的统计信息，如访问次数和累积奖励。</li>
</ul>
</li>
<li>
<p><strong>选择</strong>：</p>
<ul>
<li>从根节点开始，通过一定策略选择子节点，直到达到叶子节点（尚未被扩展的节点）。</li>
<li>选择子节点的策略通常是根据已有信息，来平衡探索未知节点和利用已知节点之间的权衡。</li>
</ul>
</li>
<li>
<p><strong>扩展</strong>：</p>
<ul>
<li>对于已选中的叶子节点，根据可行的行动扩展它，生成一个或多个子节点。</li>
<li>如果子节点中的某个代表游戏结束状态，那么不再扩展它，而是直接进入模拟步骤。</li>
</ul>
</li>
<li>
<p><strong>模拟</strong>：</p>
<ul>
<li>针对扩展的子节点，执行随机模拟或随机走子，直到达到游戏结束状态或者达到一个预定的深度限制。</li>
<li>在模拟中通常使用随机策略，以模拟游戏状态的不确定性。</li>
</ul>
</li>
<li>
<p><strong>回溯</strong>：</p>
<ul>
<li>从模拟结束的节点开始，将模拟结果的奖励值（通常是游戏胜利与否的评估）反向传播回父节点，并更新父节点的统计信息，如访问次数和累积奖励。</li>
<li>这一步鼓励树搜索在每个节点上逐渐累积关于最佳动作的信息。</li>
</ul>
</li>
<li>
<p><strong>重复</strong>：</p>
<ul>
<li>重复执行选择、扩展、模拟和回溯步骤，直到达到某个停止条件，例如时间限制或迭代次数。</li>
</ul>
</li>
<li>
<p><strong>选择最佳行动</strong>：</p>
<ul>
<li>在根节点的所有子节点中选择具有最高价值（通常是累积奖励除以访问次数）的行动作为最佳行动。</li>
<li>返回最佳行动作为决策的结果。</li>
</ul>
</li>
</ol>
<p>蒙特卡洛树搜索通过不断地模拟和探索可能的决策路径，逐渐提高对最佳行动的估计，从而在复杂的决策问题中表现出色。实际上，只要迭代的次数足够多，其选择最优解的可能性会逼近1。</p>
<p>在给出的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>M</mi><mi>C</mi><mi>T</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">SampleMCTS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span></span></span></span>中，其实现了一个十分简化的蒙特卡洛树搜索。</p>
<p>首先设定一个搜素深度和评价函数（由胜利与否和得分共同决定）。</p>
<p>然后在每一步中，用绝大部分时间去建树，迭代当前的最优解往下搜索，当到达搜索深度或者游戏结束时，反向传播不断更新父节点的值。</p>
<p>最终在时间耗尽前返回路过频率最高的那个action。（因为我们的评价函数与胜利、得分相关，即往这个方向走分多且容易胜利</p>
<p>以上。</p>
<h3 id="2-4-2-样例代码分析">2.4.2 样例代码分析</h3>
<p>由于蒙特卡洛树搜索算法是一步一步跑的，所以在act部分，每次传入当前的状态和剩余时间的接口即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Types.ACTIONS <span class="title function_">act</span><span class="params">(StateObservation stateObs, ElapsedCpuTimer elapsedTimer)</span> &#123;</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;Observation&gt; obs[] = stateObs.getFromAvatarSpritesPositions();</span><br><span class="line">    ArrayList&lt;Observation&gt; grid[][] = stateObs.getObservationGrid();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Set the state observation object as the new root of the tree.</span></span><br><span class="line">    mctsPlayer.init(stateObs);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Determine the action using MCTS...</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">action</span> <span class="operator">=</span> mctsPlayer.run(elapsedTimer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//... and return it.</span></span><br><span class="line">    <span class="keyword">return</span> actions[action];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在主体部分，rollback是随机往下面走并记录得分和胜利情况。<br>
backUp回溯过程中更新父节点的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(remaining &gt; <span class="number">2</span>*avgTimeTaken &amp;&amp; remaining &gt; remainingLimit)&#123;</span><br><span class="line">        <span class="type">ElapsedCpuTimer</span> <span class="variable">elapsedTimerIteration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElapsedCpuTimer</span>();</span><br><span class="line">        <span class="type">SingleTreeNode</span> <span class="variable">selected</span> <span class="operator">=</span> treePolicy();</span><br><span class="line">        <span class="type">double</span> <span class="variable">delta</span> <span class="operator">=</span> selected.rollOut();</span><br><span class="line">        backUp(selected, delta);</span><br><span class="line"></span><br><span class="line">        numIters++;</span><br><span class="line">        acumTimeTaken += (elapsedTimerIteration.elapsedMillis()) ;</span><br><span class="line"></span><br><span class="line">        avgTimeTaken  = acumTimeTaken/numIters;</span><br><span class="line">        remaining = elapsedTimer.remainingTimeMillis();</span><br><span class="line">        <span class="comment">//System.out.println(elapsedTimerIteration.elapsedMillis() + &quot; --&gt; &quot; + acumTimeTaken + &quot; (&quot; + remaining + &quot;)&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//System.out.println(&quot;-- &quot; + numIters + &quot; -- ( &quot; + avgTimeTaken + &quot;)&quot;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外值得一提的部分是uct函数的实现，该函数用于判断根节点的children中最有潜力的节点。</p>
<p>具体来说，每个节点的权值被定义经过的总分数的平均值再加上一个小小的随机扰动。</p>
<p>得到可以量化的分值后就可以选择最佳子节点了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> SingleTreeNode <span class="title function_">uct</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">SingleTreeNode</span> <span class="variable">selected</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">double</span> <span class="variable">bestValue</span> <span class="operator">=</span> -Double.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (SingleTreeNode child : <span class="built_in">this</span>.children)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">hvVal</span> <span class="operator">=</span> child.totValue;</span><br><span class="line">        <span class="type">double</span> <span class="variable">childValue</span> <span class="operator">=</span>  hvVal / (child.nVisits + <span class="built_in">this</span>.epsilon);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        childValue = Utils.normalise(childValue, bounds[<span class="number">0</span>], bounds[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span> <span class="variable">uctValue</span> <span class="operator">=</span> childValue +</span><br><span class="line">                Agent.K * Math.sqrt(Math.log(<span class="built_in">this</span>.nVisits + <span class="number">1</span>) / (child.nVisits + <span class="built_in">this</span>.epsilon));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// small sampleRandom numbers: break ties in unexpanded nodes</span></span><br><span class="line">        uctValue = Utils.noise(uctValue, <span class="built_in">this</span>.epsilon, <span class="built_in">this</span>.m_rnd.nextDouble());     <span class="comment">//break ties randomly</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// small sampleRandom numbers: break ties in unexpanded nodes</span></span><br><span class="line">        <span class="keyword">if</span> (uctValue &gt; bestValue) &#123;</span><br><span class="line">            selected = child;</span><br><span class="line">            bestValue = uctValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (selected == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Warning! returning null: &quot;</span> + bestValue + <span class="string">&quot; : &quot;</span> + <span class="built_in">this</span>.children.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> selected;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-结语">3 结语</h2>
<p>在本次作业中，我实现了深度优先搜索，深度限制+Astar,Astar完全版，已经了解了蒙特卡洛算法。</p>
<p>从结果上来看，发现Astar算法的效果最好，而且在不同的地图中，只需要调整一下权值就可以很好的适应不同的地图。</p>
<p>而所给的样例蒙特卡洛算法的效果并不好，可能是因为其实现的比较简单，而且没有考虑到钥匙箱子的交互问题。</p>
<p>通过本次作业的学习，我对搜索算法有了不一样的认识，也对搜索算法的实现有了更深的理解。（debug呜呜呜</p>
<p>以上。</p>
<p>（所有的源码收录于<a target="_blank" rel="noopener" href="https://github.com/detect42/HW_AIINTRO">github个人仓库</a>中）</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://detect42.github.io">Richard</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://detect42.github.io/post/776c3856.html">https://detect42.github.io/post/776c3856.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/">实验报告</a></div><div class="post_share"><div class="social-share" data-image="/img/ff.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/c9d5e149.html" title="搜索和演化算法HW1实验报告"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">搜索和演化算法HW1实验报告</div></div></a></div><div class="next-post pull-right"><a href="/post/6ab2dd9e.html" title="To_Do_List"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">To_Do_List</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/post/18a6c10f.html" title="DS作业汇报 Fibonacci堆"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-16</div><div class="title">DS作业汇报 Fibonacci堆</div></div></a></div><div><a href="/post/21249fb3.html" title="演化算法HW4 BBO黑箱芯片放置问题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-26</div><div class="title">演化算法HW4 BBO黑箱芯片放置问题</div></div></a></div><div><a href="/post/fb92b679.html" title="演化算法HW2 Maximum Cut"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-17</div><div class="title">演化算法HW2 Maximum Cut</div></div></a></div><div><a href="/post/f5193185.html" title="IntroAI_HW3 &quot;Aliens game&quot; Lab Report"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-14</div><div class="title">IntroAI_HW3 &quot;Aliens game&quot; Lab Report</div></div></a></div><div><a href="/post/97fe6ca1.html" title="人工智能导论HW2黑白棋实验报告"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-18</div><div class="title">人工智能导论HW2黑白棋实验报告</div></div></a></div><div><a href="/post/c9d5e149.html" title="搜索和演化算法HW1实验报告"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-28</div><div class="title">搜索和演化算法HW1实验报告</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#center-%E6%8A%A5%E5%91%8A%E9%A2%98%E7%9B%AE%EF%BC%9Abait%E6%B8%B8%E6%88%8F-%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95-center"><span class="toc-text"> 报告题目：Bait游戏&amp;搜索算法 </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#center-detect0530-gmail-com-center"><span class="toc-text"> detect0530@gmail.com </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80%EF%BC%9A"><span class="toc-text">引言：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9"><span class="toc-text">2 实验内容</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-task1-%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2"><span class="toc-text">2.1 Task1: 深度优先搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E8%AE%B0%E5%BD%95%E8%B5%B0%E8%BF%87%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-text">2.1.1 记录走过的状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-act%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8"><span class="toc-text">2.1.2 act接口调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.1.3 深度优先搜索的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-task1-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA"><span class="toc-text">2.1.4 TASK1 完整代码展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-algorithm-performance"><span class="toc-text">2.1.5 Algorithm Performance</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-task2-%E6%B7%B1%E5%BA%A6%E5%8F%97%E9%99%90%E7%9A%84%E6%90%9C%E7%B4%A2-%E5%88%9D%E6%AD%A5astar"><span class="toc-text">2.2 Task2: 深度受限的搜索+初步Astar</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%90%AF%E5%8F%91%E5%BC%8F%E5%87%BD%E6%95%B0%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">2.2.1 启发式函数的设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%90%9C%E7%B4%A2%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.2.2 搜索的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-task2-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA"><span class="toc-text">2.2.3 TASK2 完整代码展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-algorithm-performance"><span class="toc-text">2.2.4 Algorithm Performance</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-task3-astar%E5%90%AF%E5%8F%91%E5%BC%8F%E6%90%9C%E7%B4%A2"><span class="toc-text">2.3 Task3: Astar启发式搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-a-%E7%AE%97%E6%B3%95%E9%97%AE%E9%A2%98%E6%A6%82%E8%BF%B0%EF%BC%9A"><span class="toc-text">2.3.1 A*算法问题概述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E5%90%AF%E5%8F%91%E5%BC%8F%E5%87%BD%E6%95%B0%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">2.3.2 启发式函数的设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-a-%E7%AE%97%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.3.3 A*算法的实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-task3-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA"><span class="toc-text">2.3.4 TASK3 完整代码展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-algorithm-performance"><span class="toc-text">2.3.5 Algorithm Performance</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-task4%EF%BC%9A"><span class="toc-text">2.4 TASK4：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E6%A0%91%E6%90%9C%E7%B4%A2%E6%A6%82%E8%BF%B0"><span class="toc-text">2.4.1 蒙特卡洛树搜索概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E6%A0%B7%E4%BE%8B%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">2.4.2 样例代码分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BB%93%E8%AF%AD"><span class="toc-text">3 结语</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/topimg.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Richard</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>